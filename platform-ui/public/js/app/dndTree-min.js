function mergeOptions(a,b){b=b||{};var c={viewerWidth:$("#"+a).width(),viewerHeight:$("#"+a).height(),textFontSize:"14px",textSelectedFontSize:"15px",textSelectedColor:"#428BCA",transitionDuration:1000,collapsedNodeFill:"lightsteelblue",expandedNodeFill:"#fff"};return $.extend({},c,b)}function sortTree(){tree.sort(function(d,c){return c.name.toLowerCase()<d.name.toLowerCase()?1:-1})}function collapse(a){if(a.children){a._children=a.children;a._children.forEach(collapse);a.children=null}else{if(a._children){a._children.forEach(collapse)}}}function expand(a){if(a._children){a.children=a._children;a.children.forEach(expand);a._children=null}}function centerNode(a){scale=1;x=-a.y0;y=-a.x0;x=x*scale+50;y=y*scale+options.viewerHeight/2;d3.select("g").transition().duration(options.transitionDuration).attr("transform","translate("+x+","+y+")scale("+scale+")")}function toggleChildren(a){if(a.children){a._children=a.children;a.children=null}else{if(a._children){a.children=a._children;a._children=null}}return a}function click(f){if(d3.event.defaultPrevented){return}if(f.parent){var b=f.parent.children;if(b){b.forEach(function(d){if(d.id!=f.id&&d.children){toggleChildren(d)}})}}if(f.name=="more"){var c=f.parent;var b=c.children||c._children;var a=f.pageIndex++;if(a==f.pages.length){a=0;f.pageIndex=1}var e=f.pages[a].nodes;if(c.children){c.children=null;c.children=replaceChildren(e);c.children[c.children.length]=f}else{c._children=null;c._children=replaceChildren(e);c._children[c._children.length]=f}}f=toggleChildren(f);update(f);if(f.name!="more"){if(f.children){centerNode(f)}else{if(f.parent){centerNode(f.parent)}else{centerNode(f)}}}}function replaceChildren(a){var b=JSON.parse(JSON.stringify(a));recursiveReplaceChildren(b);return b}function recursiveReplaceChildren(a){a.forEach(function(b){b._children=b.children;b.children=null;if(b._children&&b._children.length>0){recursiveReplaceChildren(b._children)}})}function update(g){var b=tree.nodes(root).reverse(),a=tree.links(b);var f=Math.max(300,maxLabelLength*5.5);b.forEach(function(j){j.y=(j.depth*f)});node=svgGroup.selectAll("g.node").data(b,function(j){return j.id||(j.id=++i)});var c=node.enter().append("g").attr("class","node").attr("transform",function(j){return"translate("+g.y0+","+g.x0+")"});c.append("circle").attr("class","nodeCircle").attr("r",0).style("fill",function(j){return j._children?options.collapsedNodeFill:options.expandedNodeFill}).on("click",click);c.append("text").attr("x","-20").attr("dy",".35em").attr("class","nodeText").style("font-size",options.textFontSize).attr("text-anchor","start").text(function(j){if(j.name=="more"){return"page "+j.pageIndex+"/"+j.pages.length}return j.name}).style("fill-opacity",1).on("click",function(j){$(".nodeText").attr("font-weight","");$(".nodeText").css({"font-size":options.textFontSize});$(this).attr("font-weight","bold");$(this).css({"font-size":options.textSelectedFontSize});ngScope.selectConcept(j)}).attr("data-title",function(j){return j.name}).attr("data-content",function(k){var j=k.description;return j}).attr("data-toggle","popover");c.append("text").attr("text-anchor","middle").attr("dy",function(j){if(j.name=="more"){return".30em"}else{return".35em"}}).attr("class","sumText").style("font-size",function(j){if(j.name=="more"){return"25px"}else{return"12px"}}).text(function(j){if(j.name=="more"){return"+"}else{return j.sum}}).on("click",click);node.select("text").attr("x",20).attr("text-anchor","start");node.selectAll("text.nodeText").text(function(j){if(j.name=="more"){return"page "+j.pageIndex+"/"+j.pages.length}return j.name});node.selectAll("text.sumText").text(function(j){if(j.name=="more"){return"+"}else{return j.sum}});node.select("circle.nodeCircle").attr("r",15).style("fill",function(j){return j._children?options.collapsedNodeFill:options.expandedNodeFill});var e=node.transition().duration(options.transitionDuration).attr("transform",function(j){return"translate("+j.y+","+j.x+")"});e.select("text").style("fill-opacity",1);var h=node.exit().transition().duration(options.transitionDuration).attr("transform",function(j){return"translate("+g.y+","+g.x+")"}).remove();h.select("circle").attr("r",0);h.select("text").style("fill-opacity",0);var d=svgGroup.selectAll("path.link").data(a,function(j){return j.target.id});d.enter().insert("path","g").attr("class","link").attr("d",function(k){var j={x:g.x0,y:g.y0};return diagonal({source:j,target:j})});d.transition().duration(options.transitionDuration).attr("d",diagonal);d.exit().transition().duration(options.transitionDuration).attr("d",function(k){var j={x:g.x,y:g.y};return diagonal({source:j,target:j})}).remove();b.forEach(function(j){j.x0=j.x;j.y0=j.y})}function selectTextNode(a){var d=svgGroup.selectAll("text.nodeText")[0];if(d){for(var b=0;b<d.length;b++){var e=d[b];if(e.textContent==a){var c=document.createEvent("SVGEvents");c.initEvent("click",true,true);e.dispatchEvent(c)}}}}function populateParents(a,b){if(a.parent){b.unshift(a.parent);populateParents(a.parent,b)}}function setSelectedNode(b,a){for(var c=0;c<b.length;c++){if(a==b[c].conceptId){selectedNode=b[c]}else{if(b[c].children||b[c]._children){setSelectedNode(b[c].children||b[c]._children,a)}}}}function findSelectedNode(a){var c=false;for(var b=0;b<a.length;b++){if(selectedId==a[b].conceptId){c=true;break}else{if(a[b].children||a[b]._children){if(findSelectedNode(a[b].children||a[b]._children)){c=true}}}}return c}function setSelectNodeInPagination(b,a){if(!b){return}for(var c=0;c<b.length;c++){if(b[c].name=="more"){b[c].pages.forEach(function(h){for(var d=0;d<h.nodes.length;d++){var g=findSelectedNode([h.nodes[d]],selectedId);if(g){var f=0;if(c==0){f=1}var e=JSON.parse(JSON.stringify(b[f]));b[f]=h.nodes[d];h.nodes[d]=e}}})}else{setSelectNodeInPagination(b[c].children||b[c]._children,JSON.parse(JSON.stringify(a)))}}}var totalNodes=0;var maxLabelLength=0;var i=0;var root;var treeLayoutData;var options;var diagonal=d3.svg.diagonal().projection(function(a){return[a.y,a.x]});var baseSvg;var svgGroup;var tree;var selectedId;var ngScope;var selectedNode;var isInMore;function showDNDTree(e,g,b,j,d){totalNodes=0;maxLabelLength=0;i=0;root=undefined;treeLayoutData=undefined;options=undefined;baseSvg=undefined;svgGroup=undefined;tree=undefined;selectedId=undefined;ngScope=undefined;selectedNode=undefined;isInMore=undefined;ngScope=j;treeLayoutData=JSON.parse(JSON.stringify(e));options=mergeOptions(g,b);var a=d3.svg.diagonal().projection(function(k){return[k.y,k.x]});function f(n,p,m){if(!n){return}p(n);var l=m(n);if(l){var o=l.length;for(var k=0;k<o;k++){f(l[k],p,m)}}}f(treeLayoutData,function(k){totalNodes++;maxLabelLength=Math.max(k.name.length,maxLabelLength)},function(k){return k.children&&k.children.length>0?k.children:null});baseSvg=d3.select("#"+g).append("svg").attr("width",options.viewerWidth).attr("height",options.viewerHeight).attr("class","overlay");svgGroup=baseSvg.append("g");root=treeLayoutData;root.x0=0;root.y0=0;var h=[1];var c=function(l,k){if(k.children&&k.children.length>0){if(h.length<=l+1){h.push(0)}h[l+1]+=k.children.length;k.children.forEach(function(m){c(l+1,m)})}};c(0,root);tree=d3.layout.tree().nodeSize([50,50]);expandANode(d)}function expandANode(d,a){if(selectedId&&selectedId==d){if(a){selectTextNode(a)}return}selectedId=d;selectedNode=null;isInMore=false;if(!selectedId){selectedId=root.conceptId}else{var b=findSelectedNode([root]);if(!b){setSelectNodeInPagination((root.children||root._children),[])}}if(root.children){root._children=root.children;root.children=null}expand(root);tree.nodes(root).reverse();collapse(root);setSelectedNode([root],selectedId);if(selectedNode==null){root=toggleChildren(root);setTimeout(function(){update(root);centerNode(root);selectTextNode(root.name)},100)}else{var c=[];populateParents(selectedNode,c);c.forEach(function(e){e=toggleChildren(e)});selectedNode=toggleChildren(selectedNode);setTimeout(function(){update(selectedNode);if(selectedNode.children){centerNode(selectedNode)}else{if(selectedNode.parent){centerNode(selectedNode.parent)}else{centerNode(selectedNode)}}selectTextNode(selectedNode.name)},100)}};